<app-navbar></app-navbar>

<div class="teams-page">
  <h1 class="page-title">Teams</h1>

  <div *ngIf="teams.length === 0" class="no-teams">
    <p>No teams found for this company.</p>
  </div>

  <div class="teams-grid">
   <div
  *ngFor="let team of teams"
  class="team-card"
  [class.disabled]="!canAccessTeam(team)"
  (click)="canAccessTeam(team) && goToProjects(team.id, team.name)"
  [title]="canAccessTeam(team) ? 'View this team\'s projects' : 'Access restricted'"
>
      <div class="team-header">
        <h2>{{ team.name }}</h2>
        <span class="project-count">
          # of Projects: {{ team.projects?.length || 0 }}
        </span>
      </div>

      <p class="team-description">{{ team.description }}</p>

      <div class="members-section">
        <h3>Members</h3>
        <div class="member-tags">
          <span *ngFor="let user of team.users" class="member-pill">
            {{ user.username }}
          </span>
        </div>
      </div>

      <div *ngIf="isAdmin" class="team-actions" (click)="$event.stopPropagation()">
        <button class="edit-btn" (click)="updateTeam(team)">Edit</button>
        <button class="members-btn" (click)="editMembers(team)">Members</button>
        <button class="delete-btn" (click)="deleteTeam(team.id)">Delete</button>
      </div>
    </div>

    <div *ngIf="isAdmin" class="new-team-card" (click)="openModal()">
      <div class="plus-sign">+</div>
      <div>New Team</div>
    </div>
  </div>


  <div class="modal-overlay" *ngIf="showModal">
    <div class="create-team-modal">
      <button class="close-btn" (click)="closeModal()">✖</button>
      <h2>Create Team</h2>

      <div class="input-group">
        <label>Team Name</label>
        <input [(ngModel)]="newTeam.name" placeholder="Enter team name" />
      </div>

      <div class="input-group">
        <label>Description</label>
        <input [(ngModel)]="newTeam.description" placeholder="Enter description" />
      </div>

      <div class="members-section">
        <h3>Add Members</h3>

        <div class="add-member-row">
          <select [(ngModel)]="selectedUserId">
            <option value="">Pick a user</option>
            <option *ngFor="let user of allUsers" [value]="user.id">
              {{ user.username }}
            </option>
          </select>
          <button class="add-btn" (click)="addMember()">Add</button>
        </div>

        <div class="member-tags">
          <div *ngFor="let member of selectedMembers" class="member-pill">
            {{ member.username }}
            <button class="remove-btn" (click)="removeMember(member)">✖</button>
          </div>
        </div>
      </div>

      <button
        class="submit-btn"
        (click)="submitTeam()"
        [disabled]="selectedMembers.length === 0 || !newTeam.name.trim()"
        title="You must add at least one member"
      >
        Submit
      </button>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showMemberModal">
    <div class="edit-members-modal">
      <button class="close-btn" (click)="closeMemberModal()">✖</button>
      <h2>Edit Members – {{ selectedTeam?.name }}</h2>

      <div class="add-member-row">
        <select [(ngModel)]="selectedUserId">
          <option value="">Pick a user</option>
          <option *ngFor="let user of allUsers" [value]="user.id">
            {{ user.username }}
          </option>
        </select>
        <button class="add-btn" (click)="addMemberToTeam()">Add</button>
      </div>

      <div class="member-tags">
        <div *ngFor="let member of selectedTeam?.users" class="member-pill">
          {{ member.username }}
          <button class="remove-btn" (click)="removeMemberFromTeam(member)">✖</button>
        </div>
      </div>
    </div>
  </div>
</div>
